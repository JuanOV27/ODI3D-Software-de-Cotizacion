<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizaci√≥n 3D con Kiri:Moto</title>
    <link rel="stylesheet" href="css/stylecotizacion.css">
    <!-- NUEVO: Estilos de Kiri:Moto -->
    <link rel="stylesheet" href="css/kirimoto-styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="nav-back">‚Üê Volver al Men√∫</a>
            <h1>üí∞ Cotizaci√≥n de Proyectos 3D</h1>
            <p>Ahora con integraci√≥n de Kiri:Moto - Carga tus modelos STL directamente</p>
            <button class="calc-toggle-btn" onclick="toggleMobileCalc()">
                üßÆ Calculadora B√°sica
            </button>
        </div>

        <div class="main-content">
            <!-- COLUMNA DE PASOS -->
            <div class="steps-column">
                
                <!-- PASO 1: Informaci√≥n de la Pieza -->
                <div class="step-container">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Informaci√≥n de la Pieza</h3>
                    
                    <div class="form-group">
                        <label for="nombrePieza">Nombre de la Pieza</label>
                        <input type="text" id="nombrePieza" placeholder="Ej: Engranaje v2.1">
                    </div>

                    <!-- 
                        NOTA: El m√≥dulo KiriMotoIntegration autom√°ticamente
                        insertar√° aqu√≠ la secci√≥n de carga de archivos STL
                        despu√©s de este primer form-group
                    -->

                    <div class="form-group">
                        <label for="pesoPieza">
                            Peso de la Pieza (g)
                            <span style="color: #059669; font-size: 0.85rem;">
                                ‚ú® Auto-completado al cargar STL
                            </span>
                        </label>
                        <input type="number" id="pesoPieza" value="50" min="0.1" step="0.1">
                    </div>

                    <div class="form-group">
                        <label for="tiempoImpresion">
                            Tiempo de Impresi√≥n (minutos)
                            <span style="color: #059669; font-size: 0.85rem;">
                                ‚ú® Auto-completado al cargar STL
                            </span>
                        </label>
                        <input type="number" id="tiempoImpresion" value="120" min="1">
                    </div>

                    <aside class="aside-help">
                        <h4>üí° Nueva Funcionalidad</h4>
                        <p>
                            <strong>üì± En m√≥vil:</strong> Carga tu archivo STL y obt√©n peso y tiempo autom√°ticamente.<br>
                            <strong>üíª En escritorio:</strong> Adem√°s puedes editar, escalar y rotar tu modelo visualmente.
                        </p>
                    </aside>
                </div>

                <!-- PASO 2: Selecci√≥n de Filamento del Inventario -->
                <div class="step-container">
                    <div class="step-number">2</div>
                    <h3 class="step-title">üßµ Filamento del Inventario</h3>
                    
                    <div class="form-group">
                        <label for="perfilFilamentoCotizacion">Perfil de Filamento</label>
                        <select id="perfilFilamentoCotizacion" onchange="cargarPerfilFilamentoEnCotizacion()">
                            <option value="">-- Seleccionar del inventario --</option>
                        </select>
                    </div>

                    <div id="infoFilamentoSeleccionado" style="display: none;">
                        <div class="filamento-info-card">
                            <div class="filamento-header">
                                <div class="color-indicator" id="colorIndicadorCotizacion"></div>
                                <div>
                                    <h4 id="tipoMarcaCotizacion" style="margin: 0; color: #4f46e5;">-</h4>
                                    <p id="colorNombreCotizacion" style="margin: 5px 0 0 0; color: #6b7280; font-size: 0.9rem;">-</p>
                                </div>
                            </div>
                            
                            <div class="filamento-disponibilidad">
                                <div class="disponibilidad-item">
                                    <span class="label">üì¶ Disponible:</span>
                                    <span class="value" id="pesoDisponibleCotizacion">0g</span>
                                </div>
                                <div class="disponibilidad-item">
                                    <span class="label">üìä Estado:</span>
                                    <span class="value" id="estadoFilamentoCotizacion">-</span>
                                </div>
                                <div class="disponibilidad-barra">
                                    <div class="barra-fondo">
                                        <div class="barra-progreso" id="barraProgresoCotizacion" style="width: 0%"></div>
                                    </div>
                                    <span class="barra-porcentaje" id="porcentajeDisponibleCotizacion">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <aside class="aside-help">
                        <h4>üí° Ayuda</h4>
                        <p>Selecciona un filamento de tu inventario para aplicar autom√°ticamente sus costos y verificar disponibilidad.</p>
                    </aside>
                    
                    <!-- NUEVO: Campos editables de Costo y Peso integrados aqu√≠ -->
                    <div class="filamento-costos-editables" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #d1d5db;">
                        <h5 style="color: #4f46e5; margin-bottom: 15px; font-size: 1rem; font-weight: 600;">üíµ Costos del Carrete</h5>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="costoCarrete">Costo (COP)</label>
                                <input type="number" id="costoCarrete" value="120000" placeholder="120000" 
                                       min="0" step="1000">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="pesoCarrete">Peso (kg)</label>
                                <input type="number" id="pesoCarrete" value="1" placeholder="1" 
                                       min="0.1" step="0.1">
                            </div>
                        </div>
                        
                        <p style="font-size: 0.8rem; color: #6b7280; margin-top: 10px; font-style: italic;">
                            ‚ú® Se auto-completan al seleccionar el filamento. Puedes editarlos si es necesario.
                        </p>
                    </div>
                </div>

                <!-- PASO 3: Costos de Dise√±o -->
                <div class="step-container">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Costos de Dise√±o</h3>
                    
                    <div class="form-group">
                        <label for="horasDiseno">Horas de Dise√±o</label>
                        <input type="number" id="horasDiseno" value="2" min="0" step="0.5">
                    </div>

                    <div class="form-group">
                        <label for="costoHoraDiseno">Costo por Hora (COP)</label>
                        <input type="number" id="costoHoraDiseno" value="25000" min="0" step="1000">
                    </div>
                </div>

                <!-- PASO 4: Par√°metros Adicionales -->
                <div class="step-container">
                    <div class="step-number">4</div>
                    <h3 class="step-title">Par√°metros Adicionales</h3>
                    
                    <div class="form-group">
                        <label for="factorSeguridad">Factor de Seguridad</label>
                        <input type="number" id="factorSeguridad" value="1.1" min="1" step="0.1">
                    </div>

                    <div class="form-group">
                        <label for="usoElectricidad">Electricidad por Hora (COP)</label>
                        <input type="number" id="usoElectricidad" value="600" min="0" step="50">
                    </div>

                    <div class="form-group">
                        <label for="gif">GIF - Gastos Indirectos (%)</label>
                        <input type="number" id="gif" value="15" min="0" max="100" step="1">
                    </div>

                    <div class="form-group">
                        <label for="aiu">AIU - Administraci√≥n e Imprevistos (%)</label>
                        <input type="number" id="aiu" value="25" min="0" max="100" step="1">
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="incluirMarcaAgua">
                            Incluir Marca de Agua en el Modelo
                        </label>
                    </div>

                    <div class="form-group" id="grupoMarcaAgua" style="display: none;">
                        <label for="porcentajeMarcaAgua">Costo Marca de Agua (%)</label>
                        <input type="number" id="porcentajeMarcaAgua" value="10" min="0" max="50" step="1">
                    </div>
                </div>

                <!-- PASO 5: Cantidad y Lotes -->
                <div class="step-container">
                    <div class="step-number">5</div>
                    <h3 class="step-title">Cantidad y Lotes</h3>
                    
                    <div class="form-group">
                        <label for="cantidadPiezas">Cantidad Total de Piezas</label>
                        <input type="number" id="cantidadPiezas" value="1" min="1">
                    </div>

                    <div class="form-group">
                        <label for="piezasPorLote">Piezas por Lote de Impresi√≥n</label>
                        <input type="number" id="piezasPorLote" value="1" min="1">
                    </div>

                    <div id="errorLote" class="error-message" style="display: none;">
                        ‚ö†Ô∏è El n√∫mero de piezas por lote no puede ser mayor que la cantidad total
                    </div>
                </div>

                <!-- PASO 6: M√°rgenes de Venta -->
                <div class="step-container">
                    <div class="step-number">6</div>
                    <h3 class="step-title">M√°rgenes de Venta</h3>
                    
                    <div class="form-group">
                        <label for="margenMinorista">Margen Minorista (%)</label>
                        <input type="number" id="margenMinorista" value="30" min="0" max="100" step="1">
                    </div>

                    <div class="form-group">
                        <label for="margenMayorista">Margen Mayorista (%)</label>
                        <input type="number" id="margenMayorista" value="20" min="0" max="100" step="1">
                    </div>
                    
                    <aside class="aside-help">
                        <h4>üí° M√°rgenes de Ganancia</h4>
                        <p>
                            Define el porcentaje de ganancia sobre el precio base para diferentes canales de venta.
                        </p>
                    </aside>
                </div>

                <!-- Bot√≥n Calcular -->
                <div class="step-container">
                    <button class="btn btn-primary btn-large" onclick="calcularPrecio()" style="width: 100%;">
                        üéØ Calcular Cotizaci√≥n
                    </button>
                </div>
            </div>

            <!-- DIVISOR REDIMENSIONABLE -->
            <div class="resizer" id="resizer"></div>

            <!-- COLUMNA DE RESULTADOS -->
            <div class="results-column">
                <h2 class="section-title">üìä Resultados de la Cotizaci√≥n</h2>
                
                <div class="results-grid">
                    <div class="result-item highlight">
                        <span class="result-label">üí∞ Precio Base por Pieza:</span>
                        <span class="result-value" id="precioFinal">$0</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">üè≠ Costo Fabricaci√≥n:</span>
                        <span class="result-value" id="costoFabricacion">$0</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">‚ö° Costo Energ√≠a:</span>
                        <span class="result-value" id="costoEnergia">$0</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">üé® Costo Dise√±o:</span>
                        <span class="result-value" id="costoDiseno">$0</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">üîß Depreciaci√≥n M√°quina:</span>
                        <span class="result-value" id="depreciacionMaquina">$0</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">üìà Gastos Indirectos (GIF):</span>
                        <span class="result-value" id="costoGIF">$0</span>
                    </div>
                    
                    <div class="result-item">
                        <span class="result-label">üõ°Ô∏è AIU:</span>
                        <span class="result-value" id="costoAIU">$0</span>
                    </div>
                    
                    <div class="result-item" id="itemMarcaAgua" style="display: none;">
                        <span class="result-label">üè∑Ô∏è Marca de Agua:</span>
                        <span class="result-value" id="costoMarcaAguaDisplay">$0</span>
                    </div>
                    
                    <div class="result-item highlight">
                        <span class="result-label">üíµ Precio Minorista:</span>
                        <span class="result-value" id="precioMinorista">$0</span>
                    </div>
                    
                    <div class="result-item highlight">
                        <span class="result-label">üè™ Precio Mayorista:</span>
                        <span class="result-value" id="precioMayorista">$0</span>
                    </div>
                </div>

                <!-- Resumen de Pedido -->
                <div class="order-summary">
                    <h3>üìã Resumen del Pedido</h3>
                    <div class="summary-item">
                        <span>Cantidad Total:</span>
                        <span id="resumenCantidad">1 pieza</span>
                    </div>
                    <div class="summary-item">
                        <span>N√∫mero de Lotes:</span>
                        <span id="resumenLotes">1 lote</span>
                    </div>
                    <div class="summary-item highlight">
                        <span>üí∞ Costo Total (Base):</span>
                        <span id="resumenCostoTotal">$0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts existentes -->
    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
    <script src="js/cotizacion.js"></script>
    
    <!-- NUEVO: Script de integraci√≥n Kiri:Moto -->
    <script src="js/kirimoto-integration.js"></script>
    
    <!-- NUEVO: Script de redimensionamiento de paneles -->
    <script src="js/resizer.js"></script>
    
    <!-- NUEVO: Script del m√≥dulo de selecci√≥n de filamento -->
    <script src="js/cotizacion_filamento.js"></script>
</body>
</html>